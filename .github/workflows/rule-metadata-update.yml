name: rule-metadata-update
on:
  workflow_dispatch:

jobs:
  rule-metadata-update:
    runs-on: github-ubuntu-latest-s
    permissions:
      id-token: write     # required by SonarSource/vault-action-wrapper
      contents: write # write for peter-evans/create-pull-request, read for actions/checkout
      pull-requests: write # write for peter-evans/create-pull-request
    steps:
      - name: Update Rule Metadata
        id: update-rule-metadata
        uses: SonarSource/release-github-actions/update-rule-metadata@v1

      - name: Check Rule Metadata Changes
        run: |
          if [ "${{ steps.update-rule-metadata.outputs.has-changes }}" == "true" ]; then
            echo "::notice title=Rule Metadata Changes::Changes detected and PR created: ${{ steps.update-rule-metadata.outputs.pull-request-url }}"
          else
            echo "::notice title=Rule Metadata Status::No changes to the rules metadata were detected"
          fi
